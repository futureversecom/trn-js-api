7aaf77cd036fab12224b6c69a5393d92
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const type_1 = require("@polkadot/api-derive/type");
const api_1 = require("@polkadot/api");
const api_2 = require("@therootnetwork/api");
describe('e2e api calls', () => {
    let api;
    let blockHash;
    beforeAll(async () => {
        const providerUrl = 'wss://porcini.rootnet.app/archive/ws';
        const provider = new api_1.WsProvider(providerUrl);
        console.log('providerUrl', providerUrl);
        api = new api_1.ApiPromise((0, api_2.options)({ provider }));
        await api.isReady;
        blockHash = await api.rpc.chain.getBlockHash();
    });
    afterAll(async () => {
        if (api) {
            return await api.disconnect();
        }
    });
    it('Get correct block', async () => {
        const block = await api.rpc.chain.getBlock(blockHash).then((r) => r.block);
        expect(block.header.hash.toString()).toEqual(blockHash.toString());
    });
    it('Get correct validators', async () => {
        const validators = (await api.query.session.validators.at(blockHash));
        expect(validators.length).toBeGreaterThan(0);
    });
    it('Expect author is in validators', async () => {
        const block = await api.rpc.chain.getBlock(blockHash).then((r) => r.block);
        const header = block.header;
        const validators = (await api.query.session.validators.at(blockHash));
        // console.log('validators:',validators);
        const extHeader = (0, type_1.createHeaderExtended)(api.registry, header, validators);
        const author = extHeader.author;
        expect(validators).toEqual(expect.arrayContaining([expect.objectContaining(author)]));
    });
    it('Expect at least one event', async () => {
        const events = (await api.query.system.events.at(blockHash));
        expect(events.length).toBeGreaterThan(0);
    });
    describe('Get session info', () => {
        it('Get correct session information (length, last length, era, current index, session per era', async () => {
            const currentSession = await api.derive.session.info();
            expect(currentSession.currentEra.toNumber()).toBeGreaterThanOrEqual(0);
            expect(currentSession.currentIndex.toNumber()).toBeGreaterThanOrEqual(0);
            expect(currentSession.eraLength.toNumber()).toBeGreaterThanOrEqual(0);
            expect(currentSession.isEpoch).toBe(true);
            expect(currentSession.sessionLength.toNumber()).toBeGreaterThanOrEqual(0);
            expect(currentSession.sessionsPerEra.toNumber()).toBeGreaterThanOrEqual(0);
            expect(currentSession.validatorCount.toNumber()).toBeGreaterThanOrEqual(0);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2thcmlzaG1hL3dvcmsvZnV0dXJldmVyc2UvdHJuLXJvb3RuZXQtYXBpL3BhY2thZ2VzL2FwaS90ZXN0L2UyZS9hcGkuY2FsbHMuZTJlLnRzIiwibWFwcGluZ3MiOiI7O0FBY0Esb0RBQWlFO0FBQ2pFLHVDQUF1RDtBQUN2RCw2Q0FBOEM7QUFFOUMsUUFBUSxDQUFDLGVBQWUsRUFBRSxHQUFHLEVBQUU7SUFDN0IsSUFBSSxHQUFHLENBQUM7SUFDUixJQUFJLFNBQWUsQ0FBQztJQUNwQixTQUFTLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDbkIsTUFBTSxXQUFXLEdBQUcsc0NBQXNDLENBQUM7UUFDM0QsTUFBTSxRQUFRLEdBQUcsSUFBSSxnQkFBVSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQzdDLE9BQU8sQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQ3hDLEdBQUcsR0FBRyxJQUFJLGdCQUFVLENBQUMsSUFBQSxhQUFPLEVBQUMsRUFBRSxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDNUMsTUFBTSxHQUFHLENBQUMsT0FBTyxDQUFDO1FBQ2xCLFNBQVMsR0FBRyxNQUFNLEdBQUcsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQ2pELENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ2xCLElBQUksR0FBRyxFQUFFO1lBQ1AsT0FBTyxNQUFNLEdBQUcsQ0FBQyxVQUFVLEVBQUUsQ0FBQztTQUMvQjtJQUNILENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLG1CQUFtQixFQUFFLEtBQUssSUFBSSxFQUFFO1FBQ2pDLE1BQU0sS0FBSyxHQUFVLE1BQU0sR0FBRyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQU0sRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3ZGLE1BQU0s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LENBQUMsQ0FBQztZQUMzRSxNQUFNLENBQUMsY0FBYyxDQUFDLGNBQWMsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzdFLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMva2FyaXNobWEvd29yay9mdXR1cmV2ZXJzZS90cm4tcm9vdG5ldC1hcGkvcGFja2FnZXMvYXBpL3Rlc3QvZTJlL2FwaS5jYWxscy5lMmUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTktMjAyMSBDZW50cmFsaXR5IEludmVzdG1lbnRzIExpbWl0ZWRcbi8vXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuLy8geW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuLy8gWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4vL1xuLy8gICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuLy9cbi8vIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbi8vIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbi8vIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuLy8gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuLy8gbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG5pbXBvcnQgeyBIYXNoLCBCbG9jaywgQWNjb3VudElkIH0gZnJvbSBcIkB0aGVyb290bmV0d29yay90eXBlcy9pbnRlcmZhY2VzXCI7XG5pbXBvcnQgeyBjcmVhdGVIZWFkZXJFeHRlbmRlZCB9IGZyb20gJ0Bwb2xrYWRvdC9hcGktZGVyaXZlL3R5cGUnO1xuaW1wb3J0IHsgQXBpUHJvbWlzZSwgV3NQcm92aWRlciB9IGZyb20gJ0Bwb2xrYWRvdC9hcGknO1xuaW1wb3J0IHsgb3B0aW9ucyB9IGZyb20gJ0B0aGVyb290bmV0d29yay9hcGknO1xuXG5kZXNjcmliZSgnZTJlIGFwaSBjYWxscycsICgpID0+IHtcbiAgbGV0IGFwaTtcbiAgbGV0IGJsb2NrSGFzaDogSGFzaDtcbiAgYmVmb3JlQWxsKGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBwcm92aWRlclVybCA9ICd3c3M6Ly9wb3JjaW5pLnJvb3RuZXQuYXBwL2FyY2hpdmUvd3MnO1xuICAgIGNvbnN0IHByb3ZpZGVyID0gbmV3IFdzUHJvdmlkZXIocHJvdmlkZXJVcmwpO1xuICAgIGNvbnNvbGUubG9nKCdwcm92aWRlclVybCcsIHByb3ZpZGVyVXJsKTtcbiAgICBhcGkgPSBuZXcgQXBpUHJvbWlzZShvcHRpb25zKHsgcHJvdmlkZXIgfSkpO1xuICAgIGF3YWl0IGFwaS5pc1JlYWR5O1xuICAgIGJsb2NrSGFzaCA9IGF3YWl0IGFwaS5ycGMuY2hhaW4uZ2V0QmxvY2tIYXNoKCk7XG4gIH0pO1xuXG4gIGFmdGVyQWxsKGFzeW5jICgpID0+IHtcbiAgICBpZiAoYXBpKSB7XG4gICAgICByZXR1cm4gYXdhaXQgYXBpLmRpc2Nvbm5lY3QoKTtcbiAgICB9XG4gIH0pO1xuXG4gIGl0KCdHZXQgY29ycmVjdCBibG9jaycsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBibG9jazogQmxvY2sgPSBhd2FpdCBhcGkucnBjLmNoYWluLmdldEJsb2NrKGJsb2NrSGFzaCkudGhlbigocjogYW55KSA9PiByLmJsb2NrKTtcbiAgICBleHBlY3QoYmxvY2suaGVhZGVyLmhhc2gudG9TdHJpbmcoKSkudG9FcXVhbChibG9ja0hhc2gudG9TdHJpbmcoKSk7XG4gIH0pO1xuXG4gIGl0KCdHZXQgY29ycmVjdCB2YWxpZGF0b3JzJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHZhbGlkYXRvcnM6IEFjY291bnRJZFtdID0gKGF3YWl0IGFwaS5xdWVyeS5zZXNzaW9uLnZhbGlkYXRvcnMuYXQoYmxvY2tIYXNoKSkgYXMgYW55O1xuICAgIGV4cGVjdCh2YWxpZGF0b3JzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICB9KTtcblxuICBpdCgnRXhwZWN0IGF1dGhvciBpcyBpbiB2YWxpZGF0b3JzJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGJsb2NrOiBCbG9jayA9IGF3YWl0IGFwaS5ycGMuY2hhaW4uZ2V0QmxvY2soYmxvY2tIYXNoKS50aGVuKChyOiBhbnkpID0+IHIuYmxvY2spO1xuICAgIGNvbnN0IGhlYWRlciA9IGJsb2NrLmhlYWRlcjtcbiAgICBjb25zdCB2YWxpZGF0b3JzOiBBY2NvdW50SWRbXSA9IChhd2FpdCBhcGkucXVlcnkuc2Vzc2lvbi52YWxpZGF0b3JzLmF0KGJsb2NrSGFzaCkpIGFzIGFueTtcbiAgICAvLyBjb25zb2xlLmxvZygndmFsaWRhdG9yczonLHZhbGlkYXRvcnMpO1xuICAgIGNvbnN0IGV4dEhlYWRlciA9IGNyZWF0ZUhlYWRlckV4dGVuZGVkKGFwaS5yZWdpc3RyeSwgaGVhZGVyLCB2YWxpZGF0b3JzKTtcbiAgICBjb25zdCBhdXRob3I6IEFjY291bnRJZCA9IGV4dEhlYWRlci5hdXRob3I7XG4gICAgZXhwZWN0KHZhbGlkYXRvcnMpLnRvRXF1YWwoZXhwZWN0LmFycmF5Q29udGFpbmluZyhbZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoYXV0aG9yKV0pKTtcbiAgfSk7XG5cbiAgaXQoJ0V4cGVjdCBhdCBsZWFzdCBvbmUgZXZlbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgZXZlbnRzID0gKGF3YWl0IGFwaS5xdWVyeS5zeXN0ZW0uZXZlbnRzLmF0KGJsb2NrSGFzaCkpIGFzIGFueTtcbiAgICBleHBlY3QoZXZlbnRzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICB9KTtcblxuICBkZXNjcmliZSgnR2V0IHNlc3Npb24gaW5mbycsICgpID0+IHtcbiAgICBpdCgnR2V0IGNvcnJlY3Qgc2Vzc2lvbiBpbmZvcm1hdGlvbiAobGVuZ3RoLCBsYXN0IGxlbmd0aCwgZXJhLCBjdXJyZW50IGluZGV4LCBzZXNzaW9uIHBlciBlcmEnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjdXJyZW50U2Vzc2lvbiA9IGF3YWl0IGFwaS5kZXJpdmUuc2Vzc2lvbi5pbmZvKCk7XG4gICAgICBleHBlY3QoY3VycmVudFNlc3Npb24uY3VycmVudEVyYS50b051bWJlcigpKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICAgICAgZXhwZWN0KGN1cnJlbnRTZXNzaW9uLmN1cnJlbnRJbmRleC50b051bWJlcigpKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICAgICAgZXhwZWN0KGN1cnJlbnRTZXNzaW9uLmVyYUxlbmd0aC50b051bWJlcigpKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICAgICAgZXhwZWN0KGN1cnJlbnRTZXNzaW9uLmlzRXBvY2gpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoY3VycmVudFNlc3Npb24uc2Vzc2lvbkxlbmd0aC50b051bWJlcigpKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICAgICAgZXhwZWN0KGN1cnJlbnRTZXNzaW9uLnNlc3Npb25zUGVyRXJhLnRvTnVtYmVyKCkpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMCk7XG4gICAgICBleHBlY3QoY3VycmVudFNlc3Npb24udmFsaWRhdG9yQ291bnQudG9OdW1iZXIoKSkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcbiAgICB9KTtcbiAgfSk7XG5cbn0pO1xuIl0sInZlcnNpb24iOjN9