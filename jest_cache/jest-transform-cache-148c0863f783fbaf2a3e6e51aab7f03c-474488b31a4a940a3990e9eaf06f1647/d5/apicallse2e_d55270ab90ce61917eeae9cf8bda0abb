3952429468c4fec582fd773b782c05fa
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const type_1 = require("@polkadot/api-derive/type");
// import type { FrameSystemEventRecord } from '@therootnetwork/types/lookup';
const api_1 = require("@polkadot/api");
// import { WsProvider } from '@polkadot/rpc-provider';
const api_2 = require("@therootnetwork/api");
// import { Api as ApiPromise } from '../packages/api/src/Api';
describe('e2e api calls', () => {
    let api;
    let blockHash;
    beforeAll(async () => {
        const providerUrl = 'wss://porcini.rootnet.app/archive/ws';
        const provider = new api_1.WsProvider(providerUrl);
        console.log('providerUrl', providerUrl);
        api = new api_1.ApiPromise((0, api_2.options)({ provider }));
        blockHash = await api.rpc.chain.getBlockHash();
    });
    afterAll(async (done) => {
        if (api) {
            return await api.disconnect();
        }
        api = null;
        done();
    });
    it('Get correct block', async () => {
        const block = await api.rpc.chain.getBlock(blockHash).then((r) => r.block);
        expect(block.header.hash.toString()).toEqual(blockHash.toString());
    });
    it('Get correct validators', async () => {
        const validators = (await api.query.session.validators.at(blockHash));
        expect(validators.length).toBeGreaterThan(0);
    });
    it('Expect author is in validators', async () => {
        const block = await api.rpc.chain.getBlock(blockHash).then((r) => r.block);
        const header = block.header;
        const validators = (await api.query.session.validators.at(blockHash));
        const extHeader = (0, type_1.createHeaderExtended)(api.registry, header, validators);
        const author = extHeader.author;
        expect(validators).toEqual(expect.arrayContaining([expect.objectContaining(author)]));
    });
    it('Expect at least one event', async () => {
        const events = (await api.query.system.events.at(blockHash));
        expect(events.length).toBeGreaterThan(0);
    });
    describe('Get session info', () => {
        it('Get correct session information (length, last length, era, current index, session per era', async () => {
            const currentSession = await api.derive.session.info();
            expect(currentSession.currentEra.toNumber()).toBeGreaterThanOrEqual(0);
            expect(currentSession.currentIndex.toNumber()).toBeGreaterThanOrEqual(0);
            expect(currentSession.eraLength.toNumber()).toBeGreaterThanOrEqual(0);
            expect(currentSession.isEpoch).toBe(true);
            expect(currentSession.sessionLength.toNumber()).toBeGreaterThanOrEqual(0);
            expect(currentSession.sessionsPerEra.toNumber()).toBeGreaterThanOrEqual(0);
            expect(currentSession.validatorCount.toNumber()).toBeGreaterThanOrEqual(0);
        });
    });
    describe('Get core asset id', () => {
        it('Get correct spending asset id', async () => {
            const spendingAssetId = (await api.query.genericAsset.spendingAssetId.at(blockHash));
            expect(spendingAssetId.gtn(0)).toBeTruthy();
        });
        it('Get correct staking asset id', async () => {
            const stakingAssetId = (await api.query.genericAsset.stakingAssetId.at(blockHash));
            expect(stakingAssetId.gtn(0)).toBeTruthy();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2thcmlzaG1hL3dvcmsvZnV0dXJldmVyc2UvdHJuLXJvb3RuZXQtYXBpL3BhY2thZ2VzL2FwaS90ZXN0L2UyZS9hcGkuY2FsbHMuZTJlLnRzIiwibWFwcGluZ3MiOiI7O0FBY0Esb0RBQWlFO0FBQ2pFLDhFQUE4RTtBQUM5RSx1Q0FBdUQ7QUFDdkQsdURBQXVEO0FBQ3ZELDZDQUE4QztBQUM5QywrREFBK0Q7QUFFL0QsUUFBUSxDQUFDLGVBQWUsRUFBRSxHQUFHLEVBQUU7SUFDN0IsSUFBSSxHQUFHLENBQUM7SUFDUixJQUFJLFNBQWUsQ0FBQztJQUNwQixTQUFTLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDbkIsTUFBTSxXQUFXLEdBQUcsc0NBQXNDLENBQUM7UUFDM0QsTUFBTSxRQUFRLEdBQUcsSUFBSSxnQkFBVSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQzdDLE9BQU8sQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQ3hDLEdBQUcsR0FBRyxJQUFJLGdCQUFVLENBQUMsSUFBQSxhQUFPLEVBQUMsRUFBRSxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDNUMsU0FBUyxHQUFHLE1BQU0sR0FBRyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDakQsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsS0FBSyxFQUFDLElBQUksRUFBQyxFQUFFO1FBQ3BCLElBQUksR0FBRyxFQUFFO1lBQ1AsT0FBTyxNQUFNLEdBQUcsQ0FBQyxVQUFVLEVBQUUsQ0FBQztTQUMvQjtRQUNELEdBQUcsR0FBRyxJQUFJLENBQUM7UUFDWCxJQUFJLEVBQUUsQ0FBQztJQUNULENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLG1CQUFtQixFQUFFLEtBQUssSUFBSSxFQUFFO1FBQ2pDLE1BQU0sS0FBSyxHQUFVLE1BQU0sR0FBRyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FB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QUFDLGNBQWMsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzNFLE1BQU0sQ0FBQyxjQUFjLENBQUMsY0FBYyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDN0UsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7UUFDakMsRUFBRSxDQUFDLCtCQUErQixFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzdDLE1BQU0sZUFBZSxHQUFHLENBQUMsTUFBTSxHQUFHLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxlQUFlLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFZLENBQUM7WUFDaEcsTUFBTSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUM5QyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw4QkFBOEIsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM1QyxNQUFNLGNBQWMsR0FBRyxDQUFDLE1BQU0sR0FBRyxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsY0FBYyxDQUFDLEVBQUUsQ0FBQyxTQUFTLENBQUMsQ0FBWSxDQUFDO1lBQzlGLE1BQU0sQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDN0MsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9rYXJpc2htYS93b3JrL2Z1dHVyZXZlcnNlL3Rybi1yb290bmV0LWFwaS9wYWNrYWdlcy9hcGkvdGVzdC9lMmUvYXBpLmNhbGxzLmUyZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxOS0yMDIxIENlbnRyYWxpdHkgSW52ZXN0bWVudHMgTGltaXRlZFxuLy9cbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4vLyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4vLyBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbi8vXG4vLyAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4vL1xuLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuLy8gZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuLy8gV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4vLyBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4vLyBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbmltcG9ydCB7IEhhc2gsIEJsb2NrLCBBY2NvdW50SWQsIEFzc2V0SWQgfSBmcm9tIFwiQHRoZXJvb3RuZXR3b3JrL3R5cGVzL2ludGVyZmFjZXNcIjtcbmltcG9ydCB7IGNyZWF0ZUhlYWRlckV4dGVuZGVkIH0gZnJvbSAnQHBvbGthZG90L2FwaS1kZXJpdmUvdHlwZSc7XG4vLyBpbXBvcnQgdHlwZSB7IEZyYW1lU3lzdGVtRXZlbnRSZWNvcmQgfSBmcm9tICdAdGhlcm9vdG5ldHdvcmsvdHlwZXMvbG9va3VwJztcbmltcG9ydCB7IEFwaVByb21pc2UsIFdzUHJvdmlkZXIgfSBmcm9tICdAcG9sa2Fkb3QvYXBpJztcbi8vIGltcG9ydCB7IFdzUHJvdmlkZXIgfSBmcm9tICdAcG9sa2Fkb3QvcnBjLXByb3ZpZGVyJztcbmltcG9ydCB7IG9wdGlvbnMgfSBmcm9tICdAdGhlcm9vdG5ldHdvcmsvYXBpJztcbi8vIGltcG9ydCB7IEFwaSBhcyBBcGlQcm9taXNlIH0gZnJvbSAnLi4vcGFja2FnZXMvYXBpL3NyYy9BcGknO1xuXG5kZXNjcmliZSgnZTJlIGFwaSBjYWxscycsICgpID0+IHtcbiAgbGV0IGFwaTtcbiAgbGV0IGJsb2NrSGFzaDogSGFzaDtcbiAgYmVmb3JlQWxsKGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBwcm92aWRlclVybCA9ICd3c3M6Ly9wb3JjaW5pLnJvb3RuZXQuYXBwL2FyY2hpdmUvd3MnO1xuICAgIGNvbnN0IHByb3ZpZGVyID0gbmV3IFdzUHJvdmlkZXIocHJvdmlkZXJVcmwpO1xuICAgIGNvbnNvbGUubG9nKCdwcm92aWRlclVybCcsIHByb3ZpZGVyVXJsKTtcbiAgICBhcGkgPSBuZXcgQXBpUHJvbWlzZShvcHRpb25zKHsgcHJvdmlkZXIgfSkpO1xuICAgIGJsb2NrSGFzaCA9IGF3YWl0IGFwaS5ycGMuY2hhaW4uZ2V0QmxvY2tIYXNoKCk7XG4gIH0pO1xuXG4gIGFmdGVyQWxsKGFzeW5jIGRvbmUgPT4ge1xuICAgIGlmIChhcGkpIHtcbiAgICAgIHJldHVybiBhd2FpdCBhcGkuZGlzY29ubmVjdCgpO1xuICAgIH1cbiAgICBhcGkgPSBudWxsO1xuICAgIGRvbmUoKTtcbiAgfSk7XG5cbiAgaXQoJ0dldCBjb3JyZWN0IGJsb2NrJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGJsb2NrOiBCbG9jayA9IGF3YWl0IGFwaS5ycGMuY2hhaW4uZ2V0QmxvY2soYmxvY2tIYXNoKS50aGVuKChyOiBhbnkpID0+IHIuYmxvY2spO1xuICAgIGV4cGVjdChibG9jay5oZWFkZXIuaGFzaC50b1N0cmluZygpKS50b0VxdWFsKGJsb2NrSGFzaC50b1N0cmluZygpKTtcbiAgfSk7XG5cbiAgaXQoJ0dldCBjb3JyZWN0IHZhbGlkYXRvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgdmFsaWRhdG9yczogQWNjb3VudElkW10gPSAoYXdhaXQgYXBpLnF1ZXJ5LnNlc3Npb24udmFsaWRhdG9ycy5hdChibG9ja0hhc2gpKSBhcyBhbnk7XG4gICAgZXhwZWN0KHZhbGlkYXRvcnMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gIH0pO1xuXG4gIGl0KCdFeHBlY3QgYXV0aG9yIGlzIGluIHZhbGlkYXRvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgYmxvY2s6IEJsb2NrID0gYXdhaXQgYXBpLnJwYy5jaGFpbi5nZXRCbG9jayhibG9ja0hhc2gpLnRoZW4oKHI6IGFueSkgPT4gci5ibG9jayk7XG4gICAgY29uc3QgaGVhZGVyID0gYmxvY2suaGVhZGVyO1xuICAgIGNvbnN0IHZhbGlkYXRvcnM6IEFjY291bnRJZFtdID0gKGF3YWl0IGFwaS5xdWVyeS5zZXNzaW9uLnZhbGlkYXRvcnMuYXQoYmxvY2tIYXNoKSkgYXMgYW55O1xuICAgIGNvbnN0IGV4dEhlYWRlciA9IGNyZWF0ZUhlYWRlckV4dGVuZGVkKGFwaS5yZWdpc3RyeSwgaGVhZGVyLCB2YWxpZGF0b3JzKTtcbiAgICBjb25zdCBhdXRob3I6IEFjY291bnRJZCA9IGV4dEhlYWRlci5hdXRob3I7XG4gICAgZXhwZWN0KHZhbGlkYXRvcnMpLnRvRXF1YWwoZXhwZWN0LmFycmF5Q29udGFpbmluZyhbZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoYXV0aG9yKV0pKTtcbiAgfSk7XG5cbiAgaXQoJ0V4cGVjdCBhdCBsZWFzdCBvbmUgZXZlbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgZXZlbnRzID0gKGF3YWl0IGFwaS5xdWVyeS5zeXN0ZW0uZXZlbnRzLmF0KGJsb2NrSGFzaCkpIGFzIGFueTtcbiAgICBleHBlY3QoZXZlbnRzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICB9KTtcblxuICBkZXNjcmliZSgnR2V0IHNlc3Npb24gaW5mbycsICgpID0+IHtcbiAgICBpdCgnR2V0IGNvcnJlY3Qgc2Vzc2lvbiBpbmZvcm1hdGlvbiAobGVuZ3RoLCBsYXN0IGxlbmd0aCwgZXJhLCBjdXJyZW50IGluZGV4LCBzZXNzaW9uIHBlciBlcmEnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjdXJyZW50U2Vzc2lvbiA9IGF3YWl0IGFwaS5kZXJpdmUuc2Vzc2lvbi5pbmZvKCk7XG4gICAgICBleHBlY3QoY3VycmVudFNlc3Npb24uY3VycmVudEVyYS50b051bWJlcigpKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICAgICAgZXhwZWN0KGN1cnJlbnRTZXNzaW9uLmN1cnJlbnRJbmRleC50b051bWJlcigpKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICAgICAgZXhwZWN0KGN1cnJlbnRTZXNzaW9uLmVyYUxlbmd0aC50b051bWJlcigpKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICAgICAgZXhwZWN0KGN1cnJlbnRTZXNzaW9uLmlzRXBvY2gpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoY3VycmVudFNlc3Npb24uc2Vzc2lvbkxlbmd0aC50b051bWJlcigpKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICAgICAgZXhwZWN0KGN1cnJlbnRTZXNzaW9uLnNlc3Npb25zUGVyRXJhLnRvTnVtYmVyKCkpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMCk7XG4gICAgICBleHBlY3QoY3VycmVudFNlc3Npb24udmFsaWRhdG9yQ291bnQudG9OdW1iZXIoKSkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0dldCBjb3JlIGFzc2V0IGlkJywgKCkgPT4ge1xuICAgIGl0KCdHZXQgY29ycmVjdCBzcGVuZGluZyBhc3NldCBpZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHNwZW5kaW5nQXNzZXRJZCA9IChhd2FpdCBhcGkucXVlcnkuZ2VuZXJpY0Fzc2V0LnNwZW5kaW5nQXNzZXRJZC5hdChibG9ja0hhc2gpKSBhcyBBc3NldElkO1xuICAgICAgZXhwZWN0KHNwZW5kaW5nQXNzZXRJZC5ndG4oMCkpLnRvQmVUcnV0aHkoKTtcbiAgICB9KTtcblxuICAgIGl0KCdHZXQgY29ycmVjdCBzdGFraW5nIGFzc2V0IGlkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc3Rha2luZ0Fzc2V0SWQgPSAoYXdhaXQgYXBpLnF1ZXJ5LmdlbmVyaWNBc3NldC5zdGFraW5nQXNzZXRJZC5hdChibG9ja0hhc2gpKSBhcyBBc3NldElkO1xuICAgICAgZXhwZWN0KHN0YWtpbmdBc3NldElkLmd0bigwKSkudG9CZVRydXRoeSgpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9