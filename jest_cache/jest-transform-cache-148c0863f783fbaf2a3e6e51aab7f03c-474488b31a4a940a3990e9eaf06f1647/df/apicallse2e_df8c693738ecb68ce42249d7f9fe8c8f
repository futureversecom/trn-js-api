d95c66b4e54e57c589d42704b50b1345
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const type_1 = require("@polkadot/api-derive/type");
// import type { FrameSystemEventRecord } from '@therootnetwork/types/lookup';
const api_1 = require("@polkadot/api");
// import { WsProvider } from '@polkadot/rpc-provider';
const api_2 = require("@therootnetwork/api");
// import { Api as ApiPromise } from '../packages/api/src/Api';
describe('e2e api calls', () => {
    let api;
    let blockHash;
    beforeAll(async () => {
        const providerUrl = 'wss://porcini.rootnet.app/archive/ws';
        const provider = new api_1.WsProvider(providerUrl);
        console.log('providerUrl', providerUrl);
        api = new api_1.ApiPromise((0, api_2.options)({ provider }));
        await api.isReady;
        blockHash = await api.rpc.chain.getBlockHash();
    });
    afterAll(async (done) => {
        if (api) {
            return await api.disconnect();
        }
        api = null;
        done();
    });
    it('Get correct block', async () => {
        const block = await api.rpc.chain.getBlock(blockHash).then((r) => r.block);
        expect(block.header.hash.toString()).toEqual(blockHash.toString());
    });
    it('Get correct validators', async () => {
        const validators = (await api.query.session.validators.at(blockHash));
        expect(validators.length).toBeGreaterThan(0);
    });
    it('Expect author is in validators', async () => {
        const block = await api.rpc.chain.getBlock(blockHash).then((r) => r.block);
        const header = block.header;
        const validators = (await api.query.session.validators.at(blockHash));
        // console.log('validators:',validators);
        const extHeader = (0, type_1.createHeaderExtended)(api.registry, header, validators);
        const author = extHeader.author;
        expect(validators).toEqual(expect.arrayContaining([expect.objectContaining(author)]));
    });
    it('Expect at least one event', async () => {
        const events = (await api.query.system.events.at(blockHash));
        expect(events.length).toBeGreaterThan(0);
    });
    describe('Get session info', () => {
        it('Get correct session information (length, last length, era, current index, session per era', async () => {
            const currentSession = await api.derive.session.info();
            expect(currentSession.currentEra.toNumber()).toBeGreaterThanOrEqual(0);
            expect(currentSession.currentIndex.toNumber()).toBeGreaterThanOrEqual(0);
            expect(currentSession.eraLength.toNumber()).toBeGreaterThanOrEqual(0);
            expect(currentSession.isEpoch).toBe(true);
            expect(currentSession.sessionLength.toNumber()).toBeGreaterThanOrEqual(0);
            expect(currentSession.sessionsPerEra.toNumber()).toBeGreaterThanOrEqual(0);
            expect(currentSession.validatorCount.toNumber()).toBeGreaterThanOrEqual(0);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2thcmlzaG1hL3dvcmsvZnV0dXJldmVyc2UvdHJuLXJvb3RuZXQtYXBpL3BhY2thZ2VzL2FwaS90ZXN0L2UyZS9hcGkuY2FsbHMuZTJlLnRzIiwibWFwcGluZ3MiOiI7O0FBY0Esb0RBQWlFO0FBQ2pFLDhFQUE4RTtBQUM5RSx1Q0FBdUQ7QUFDdkQsdURBQXVEO0FBQ3ZELDZDQUE4QztBQUM5QywrREFBK0Q7QUFFL0QsUUFBUSxDQUFDLGVBQWUsRUFBRSxHQUFHLEVBQUU7SUFDN0IsSUFBSSxHQUFHLENBQUM7SUFDUixJQUFJLFNBQWUsQ0FBQztJQUNwQixTQUFTLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDbkIsTUFBTSxXQUFXLEdBQUcsc0NBQXNDLENBQUM7UUFDM0QsTUFBTSxRQUFRLEdBQUcsSUFBSSxnQkFBVSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQzdDLE9BQU8sQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQ3hDLEdBQUcsR0FBRyxJQUFJLGdCQUFVLENBQUMsSUFBQSxhQUFPLEVBQUMsRUFBRSxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDNUMsTUFBTSxHQUFHLENBQUMsT0FBTyxDQUFDO1FBQ2xCLFNBQVMsR0FBRyxNQUFNLEdBQUcsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQ2pELENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLEtBQUssRUFBQyxJQUFJLEVBQUMsRUFBRTtRQUNwQixJQUFJLEdBQUcsRUFBRTtZQUNQLE9BQU8sTUFBTSxHQUFHLENBQUMsVUFBVSxFQUFFLENBQUM7U0FDL0I7UUFDRCxHQUFHLEdBQUcsSUFBSSxDQUFDO1FBQ1gsSUFBSSxFQUFFLENBQUM7SUFDVCxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyxtQkFBbUIsRUFBRSxLQUFLLElBQUksRUFBRTtRQUNqQyxNQUFNLEtBQUssR0FBVSxNQUFNLEdBQUcsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLFFB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QixDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzFFLE1BQU0sQ0FBQyxjQUFjLENBQUMsY0FBYyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDM0UsTUFBTSxDQUFDLGNBQWMsQ0FBQyxjQUFjLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM3RSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUwsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2thcmlzaG1hL3dvcmsvZnV0dXJldmVyc2UvdHJuLXJvb3RuZXQtYXBpL3BhY2thZ2VzL2FwaS90ZXN0L2UyZS9hcGkuY2FsbHMuZTJlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE5LTIwMjEgQ2VudHJhbGl0eSBJbnZlc3RtZW50cyBMaW1pdGVkXG4vL1xuLy8gTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbi8vIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbi8vIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuLy9cbi8vICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbi8vXG4vLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4vLyBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4vLyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbi8vIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbi8vIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuaW1wb3J0IHsgSGFzaCwgQmxvY2ssIEFjY291bnRJZCwgQXNzZXRJZCB9IGZyb20gXCJAdGhlcm9vdG5ldHdvcmsvdHlwZXMvaW50ZXJmYWNlc1wiO1xuaW1wb3J0IHsgY3JlYXRlSGVhZGVyRXh0ZW5kZWQgfSBmcm9tICdAcG9sa2Fkb3QvYXBpLWRlcml2ZS90eXBlJztcbi8vIGltcG9ydCB0eXBlIHsgRnJhbWVTeXN0ZW1FdmVudFJlY29yZCB9IGZyb20gJ0B0aGVyb290bmV0d29yay90eXBlcy9sb29rdXAnO1xuaW1wb3J0IHsgQXBpUHJvbWlzZSwgV3NQcm92aWRlciB9IGZyb20gJ0Bwb2xrYWRvdC9hcGknO1xuLy8gaW1wb3J0IHsgV3NQcm92aWRlciB9IGZyb20gJ0Bwb2xrYWRvdC9ycGMtcHJvdmlkZXInO1xuaW1wb3J0IHsgb3B0aW9ucyB9IGZyb20gJ0B0aGVyb290bmV0d29yay9hcGknO1xuLy8gaW1wb3J0IHsgQXBpIGFzIEFwaVByb21pc2UgfSBmcm9tICcuLi9wYWNrYWdlcy9hcGkvc3JjL0FwaSc7XG5cbmRlc2NyaWJlKCdlMmUgYXBpIGNhbGxzJywgKCkgPT4ge1xuICBsZXQgYXBpO1xuICBsZXQgYmxvY2tIYXNoOiBIYXNoO1xuICBiZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHByb3ZpZGVyVXJsID0gJ3dzczovL3BvcmNpbmkucm9vdG5ldC5hcHAvYXJjaGl2ZS93cyc7XG4gICAgY29uc3QgcHJvdmlkZXIgPSBuZXcgV3NQcm92aWRlcihwcm92aWRlclVybCk7XG4gICAgY29uc29sZS5sb2coJ3Byb3ZpZGVyVXJsJywgcHJvdmlkZXJVcmwpO1xuICAgIGFwaSA9IG5ldyBBcGlQcm9taXNlKG9wdGlvbnMoeyBwcm92aWRlciB9KSk7XG4gICAgYXdhaXQgYXBpLmlzUmVhZHk7XG4gICAgYmxvY2tIYXNoID0gYXdhaXQgYXBpLnJwYy5jaGFpbi5nZXRCbG9ja0hhc2goKTtcbiAgfSk7XG5cbiAgYWZ0ZXJBbGwoYXN5bmMgZG9uZSA9PiB7XG4gICAgaWYgKGFwaSkge1xuICAgICAgcmV0dXJuIGF3YWl0IGFwaS5kaXNjb25uZWN0KCk7XG4gICAgfVxuICAgIGFwaSA9IG51bGw7XG4gICAgZG9uZSgpO1xuICB9KTtcblxuICBpdCgnR2V0IGNvcnJlY3QgYmxvY2snLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgYmxvY2s6IEJsb2NrID0gYXdhaXQgYXBpLnJwYy5jaGFpbi5nZXRCbG9jayhibG9ja0hhc2gpLnRoZW4oKHI6IGFueSkgPT4gci5ibG9jayk7XG4gICAgZXhwZWN0KGJsb2NrLmhlYWRlci5oYXNoLnRvU3RyaW5nKCkpLnRvRXF1YWwoYmxvY2tIYXNoLnRvU3RyaW5nKCkpO1xuICB9KTtcblxuICBpdCgnR2V0IGNvcnJlY3QgdmFsaWRhdG9ycycsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCB2YWxpZGF0b3JzOiBBY2NvdW50SWRbXSA9IChhd2FpdCBhcGkucXVlcnkuc2Vzc2lvbi52YWxpZGF0b3JzLmF0KGJsb2NrSGFzaCkpIGFzIGFueTtcbiAgICBleHBlY3QodmFsaWRhdG9ycy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgfSk7XG5cbiAgaXQoJ0V4cGVjdCBhdXRob3IgaXMgaW4gdmFsaWRhdG9ycycsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBibG9jazogQmxvY2sgPSBhd2FpdCBhcGkucnBjLmNoYWluLmdldEJsb2NrKGJsb2NrSGFzaCkudGhlbigocjogYW55KSA9PiByLmJsb2NrKTtcbiAgICBjb25zdCBoZWFkZXIgPSBibG9jay5oZWFkZXI7XG4gICAgY29uc3QgdmFsaWRhdG9yczogQWNjb3VudElkW10gPSAoYXdhaXQgYXBpLnF1ZXJ5LnNlc3Npb24udmFsaWRhdG9ycy5hdChibG9ja0hhc2gpKSBhcyBhbnk7XG4gICAgLy8gY29uc29sZS5sb2coJ3ZhbGlkYXRvcnM6Jyx2YWxpZGF0b3JzKTtcbiAgICBjb25zdCBleHRIZWFkZXIgPSBjcmVhdGVIZWFkZXJFeHRlbmRlZChhcGkucmVnaXN0cnksIGhlYWRlciwgdmFsaWRhdG9ycyk7XG4gICAgY29uc3QgYXV0aG9yOiBBY2NvdW50SWQgPSBleHRIZWFkZXIuYXV0aG9yO1xuICAgIGV4cGVjdCh2YWxpZGF0b3JzKS50b0VxdWFsKGV4cGVjdC5hcnJheUNvbnRhaW5pbmcoW2V4cGVjdC5vYmplY3RDb250YWluaW5nKGF1dGhvcildKSk7XG4gIH0pO1xuXG4gIGl0KCdFeHBlY3QgYXQgbGVhc3Qgb25lIGV2ZW50JywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGV2ZW50cyA9IChhd2FpdCBhcGkucXVlcnkuc3lzdGVtLmV2ZW50cy5hdChibG9ja0hhc2gpKSBhcyBhbnk7XG4gICAgZXhwZWN0KGV2ZW50cy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0dldCBzZXNzaW9uIGluZm8nLCAoKSA9PiB7XG4gICAgaXQoJ0dldCBjb3JyZWN0IHNlc3Npb24gaW5mb3JtYXRpb24gKGxlbmd0aCwgbGFzdCBsZW5ndGgsIGVyYSwgY3VycmVudCBpbmRleCwgc2Vzc2lvbiBwZXIgZXJhJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY3VycmVudFNlc3Npb24gPSBhd2FpdCBhcGkuZGVyaXZlLnNlc3Npb24uaW5mbygpO1xuICAgICAgZXhwZWN0KGN1cnJlbnRTZXNzaW9uLmN1cnJlbnRFcmEudG9OdW1iZXIoKSkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcbiAgICAgIGV4cGVjdChjdXJyZW50U2Vzc2lvbi5jdXJyZW50SW5kZXgudG9OdW1iZXIoKSkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcbiAgICAgIGV4cGVjdChjdXJyZW50U2Vzc2lvbi5lcmFMZW5ndGgudG9OdW1iZXIoKSkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcbiAgICAgIGV4cGVjdChjdXJyZW50U2Vzc2lvbi5pc0Vwb2NoKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGN1cnJlbnRTZXNzaW9uLnNlc3Npb25MZW5ndGgudG9OdW1iZXIoKSkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcbiAgICAgIGV4cGVjdChjdXJyZW50U2Vzc2lvbi5zZXNzaW9uc1BlckVyYS50b051bWJlcigpKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICAgICAgZXhwZWN0KGN1cnJlbnRTZXNzaW9uLnZhbGlkYXRvckNvdW50LnRvTnVtYmVyKCkpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMCk7XG4gICAgfSk7XG4gIH0pO1xuXG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==