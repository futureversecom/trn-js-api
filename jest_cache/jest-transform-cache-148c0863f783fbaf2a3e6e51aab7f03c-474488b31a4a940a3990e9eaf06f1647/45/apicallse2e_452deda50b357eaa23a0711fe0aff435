c3a453e6beab9a1a80586f35e3a716c1
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const type_1 = require("@polkadot/api-derive/type");
const api_1 = require("@polkadot/api");
const api_2 = require("@therootnetwork/api");
describe('e2e api calls', () => {
    let api;
    let blockHash;
    beforeAll(async () => {
        const providerUrl = 'wss://porcini.rootnet.app/archive/ws';
        const provider = new api_1.WsProvider(providerUrl);
        console.log('providerUrl', providerUrl);
        api = new api_1.ApiPromise((0, api_2.options)({ provider }));
        await api.isReady;
        blockHash = await api.rpc.chain.getBlockHash();
    });
    afterAll(async (done) => {
        if (api) {
            return await api.disconnect();
        }
        api = null;
        done();
    });
    it('Get correct block', async () => {
        const block = await api.rpc.chain.getBlock(blockHash).then((r) => r.block);
        expect(block.header.hash.toString()).toEqual(blockHash.toString());
    });
    it('Get correct validators', async () => {
        const validators = (await api.query.session.validators.at(blockHash));
        expect(validators.length).toBeGreaterThan(0);
    });
    it('Expect author is in validators', async () => {
        const block = await api.rpc.chain.getBlock(blockHash).then((r) => r.block);
        const header = block.header;
        const validators = (await api.query.session.validators.at(blockHash));
        // console.log('validators:',validators);
        const extHeader = (0, type_1.createHeaderExtended)(api.registry, header, validators);
        const author = extHeader.author;
        expect(validators).toEqual(expect.arrayContaining([expect.objectContaining(author)]));
    });
    it('Expect at least one event', async () => {
        const events = (await api.query.system.events.at(blockHash));
        expect(events.length).toBeGreaterThan(0);
    });
    describe('Get session info', () => {
        it('Get correct session information (length, last length, era, current index, session per era', async () => {
            const currentSession = await api.derive.session.info();
            expect(currentSession.currentEra.toNumber()).toBeGreaterThanOrEqual(0);
            expect(currentSession.currentIndex.toNumber()).toBeGreaterThanOrEqual(0);
            expect(currentSession.eraLength.toNumber()).toBeGreaterThanOrEqual(0);
            expect(currentSession.isEpoch).toBe(true);
            expect(currentSession.sessionLength.toNumber()).toBeGreaterThanOrEqual(0);
            expect(currentSession.sessionsPerEra.toNumber()).toBeGreaterThanOrEqual(0);
            expect(currentSession.validatorCount.toNumber()).toBeGreaterThanOrEqual(0);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2thcmlzaG1hL3dvcmsvZnV0dXJldmVyc2UvdHJuLXJvb3RuZXQtYXBpL3BhY2thZ2VzL2FwaS90ZXN0L2UyZS9hcGkuY2FsbHMuZTJlLnRzIiwibWFwcGluZ3MiOiI7O0FBY0Esb0RBQWlFO0FBQ2pFLHVDQUF1RDtBQUN2RCw2Q0FBOEM7QUFFOUMsUUFBUSxDQUFDLGVBQWUsRUFBRSxHQUFHLEVBQUU7SUFDN0IsSUFBSSxHQUFHLENBQUM7SUFDUixJQUFJLFNBQWUsQ0FBQztJQUNwQixTQUFTLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDbkIsTUFBTSxXQUFXLEdBQUcsc0NBQXNDLENBQUM7UUFDM0QsTUFBTSxRQUFRLEdBQUcsSUFBSSxnQkFBVSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQzdDLE9BQU8sQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQ3hDLEdBQUcsR0FBRyxJQUFJLGdCQUFVLENBQUMsSUFBQSxhQUFPLEVBQUMsRUFBRSxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDNUMsTUFBTSxHQUFHLENBQUMsT0FBTyxDQUFDO1FBQ2xCLFNBQVMsR0FBRyxNQUFNLEdBQUcsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQ2pELENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLEtBQUssRUFBQyxJQUFJLEVBQUMsRUFBRTtRQUNwQixJQUFJLEdBQUcsRUFBRTtZQUNQLE9BQU8sTUFBTSxHQUFHLENBQUMsVUFBVSxFQUFFLENBQUM7U0FDL0I7UUFDRCxHQUFHLEdBQUcsSUFBSSxDQUFDO1FBQ1gsSUFBSSxFQUFFLENBQUM7SUFDVCxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyxtQkFBbUIsRUFBRSxLQUFLLElBQUksRUFBRTtRQUNqQyxNQUFNLEtBQUssR0FBVSxNQUFNLEdBQUcsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxD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QUFjLENBQUMsY0FBYyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDM0UsTUFBTSxDQUFDLGNBQWMsQ0FBQyxjQUFjLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM3RSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUwsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2thcmlzaG1hL3dvcmsvZnV0dXJldmVyc2UvdHJuLXJvb3RuZXQtYXBpL3BhY2thZ2VzL2FwaS90ZXN0L2UyZS9hcGkuY2FsbHMuZTJlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE5LTIwMjEgQ2VudHJhbGl0eSBJbnZlc3RtZW50cyBMaW1pdGVkXG4vL1xuLy8gTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbi8vIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbi8vIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuLy9cbi8vICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbi8vXG4vLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4vLyBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4vLyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbi8vIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbi8vIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuaW1wb3J0IHsgSGFzaCwgQmxvY2ssIEFjY291bnRJZCB9IGZyb20gXCJAdGhlcm9vdG5ldHdvcmsvdHlwZXMvaW50ZXJmYWNlc1wiO1xuaW1wb3J0IHsgY3JlYXRlSGVhZGVyRXh0ZW5kZWQgfSBmcm9tICdAcG9sa2Fkb3QvYXBpLWRlcml2ZS90eXBlJztcbmltcG9ydCB7IEFwaVByb21pc2UsIFdzUHJvdmlkZXIgfSBmcm9tICdAcG9sa2Fkb3QvYXBpJztcbmltcG9ydCB7IG9wdGlvbnMgfSBmcm9tICdAdGhlcm9vdG5ldHdvcmsvYXBpJztcblxuZGVzY3JpYmUoJ2UyZSBhcGkgY2FsbHMnLCAoKSA9PiB7XG4gIGxldCBhcGk7XG4gIGxldCBibG9ja0hhc2g6IEhhc2g7XG4gIGJlZm9yZUFsbChhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgcHJvdmlkZXJVcmwgPSAnd3NzOi8vcG9yY2luaS5yb290bmV0LmFwcC9hcmNoaXZlL3dzJztcbiAgICBjb25zdCBwcm92aWRlciA9IG5ldyBXc1Byb3ZpZGVyKHByb3ZpZGVyVXJsKTtcbiAgICBjb25zb2xlLmxvZygncHJvdmlkZXJVcmwnLCBwcm92aWRlclVybCk7XG4gICAgYXBpID0gbmV3IEFwaVByb21pc2Uob3B0aW9ucyh7IHByb3ZpZGVyIH0pKTtcbiAgICBhd2FpdCBhcGkuaXNSZWFkeTtcbiAgICBibG9ja0hhc2ggPSBhd2FpdCBhcGkucnBjLmNoYWluLmdldEJsb2NrSGFzaCgpO1xuICB9KTtcblxuICBhZnRlckFsbChhc3luYyBkb25lID0+IHtcbiAgICBpZiAoYXBpKSB7XG4gICAgICByZXR1cm4gYXdhaXQgYXBpLmRpc2Nvbm5lY3QoKTtcbiAgICB9XG4gICAgYXBpID0gbnVsbDtcbiAgICBkb25lKCk7XG4gIH0pO1xuXG4gIGl0KCdHZXQgY29ycmVjdCBibG9jaycsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBibG9jazogQmxvY2sgPSBhd2FpdCBhcGkucnBjLmNoYWluLmdldEJsb2NrKGJsb2NrSGFzaCkudGhlbigocjogYW55KSA9PiByLmJsb2NrKTtcbiAgICBleHBlY3QoYmxvY2suaGVhZGVyLmhhc2gudG9TdHJpbmcoKSkudG9FcXVhbChibG9ja0hhc2gudG9TdHJpbmcoKSk7XG4gIH0pO1xuXG4gIGl0KCdHZXQgY29ycmVjdCB2YWxpZGF0b3JzJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHZhbGlkYXRvcnM6IEFjY291bnRJZFtdID0gKGF3YWl0IGFwaS5xdWVyeS5zZXNzaW9uLnZhbGlkYXRvcnMuYXQoYmxvY2tIYXNoKSkgYXMgYW55O1xuICAgIGV4cGVjdCh2YWxpZGF0b3JzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICB9KTtcblxuICBpdCgnRXhwZWN0IGF1dGhvciBpcyBpbiB2YWxpZGF0b3JzJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGJsb2NrOiBCbG9jayA9IGF3YWl0IGFwaS5ycGMuY2hhaW4uZ2V0QmxvY2soYmxvY2tIYXNoKS50aGVuKChyOiBhbnkpID0+IHIuYmxvY2spO1xuICAgIGNvbnN0IGhlYWRlciA9IGJsb2NrLmhlYWRlcjtcbiAgICBjb25zdCB2YWxpZGF0b3JzOiBBY2NvdW50SWRbXSA9IChhd2FpdCBhcGkucXVlcnkuc2Vzc2lvbi52YWxpZGF0b3JzLmF0KGJsb2NrSGFzaCkpIGFzIGFueTtcbiAgICAvLyBjb25zb2xlLmxvZygndmFsaWRhdG9yczonLHZhbGlkYXRvcnMpO1xuICAgIGNvbnN0IGV4dEhlYWRlciA9IGNyZWF0ZUhlYWRlckV4dGVuZGVkKGFwaS5yZWdpc3RyeSwgaGVhZGVyLCB2YWxpZGF0b3JzKTtcbiAgICBjb25zdCBhdXRob3I6IEFjY291bnRJZCA9IGV4dEhlYWRlci5hdXRob3I7XG4gICAgZXhwZWN0KHZhbGlkYXRvcnMpLnRvRXF1YWwoZXhwZWN0LmFycmF5Q29udGFpbmluZyhbZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoYXV0aG9yKV0pKTtcbiAgfSk7XG5cbiAgaXQoJ0V4cGVjdCBhdCBsZWFzdCBvbmUgZXZlbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgZXZlbnRzID0gKGF3YWl0IGFwaS5xdWVyeS5zeXN0ZW0uZXZlbnRzLmF0KGJsb2NrSGFzaCkpIGFzIGFueTtcbiAgICBleHBlY3QoZXZlbnRzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICB9KTtcblxuICBkZXNjcmliZSgnR2V0IHNlc3Npb24gaW5mbycsICgpID0+IHtcbiAgICBpdCgnR2V0IGNvcnJlY3Qgc2Vzc2lvbiBpbmZvcm1hdGlvbiAobGVuZ3RoLCBsYXN0IGxlbmd0aCwgZXJhLCBjdXJyZW50IGluZGV4LCBzZXNzaW9uIHBlciBlcmEnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjdXJyZW50U2Vzc2lvbiA9IGF3YWl0IGFwaS5kZXJpdmUuc2Vzc2lvbi5pbmZvKCk7XG4gICAgICBleHBlY3QoY3VycmVudFNlc3Npb24uY3VycmVudEVyYS50b051bWJlcigpKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICAgICAgZXhwZWN0KGN1cnJlbnRTZXNzaW9uLmN1cnJlbnRJbmRleC50b051bWJlcigpKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICAgICAgZXhwZWN0KGN1cnJlbnRTZXNzaW9uLmVyYUxlbmd0aC50b051bWJlcigpKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICAgICAgZXhwZWN0KGN1cnJlbnRTZXNzaW9uLmlzRXBvY2gpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoY3VycmVudFNlc3Npb24uc2Vzc2lvbkxlbmd0aC50b051bWJlcigpKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICAgICAgZXhwZWN0KGN1cnJlbnRTZXNzaW9uLnNlc3Npb25zUGVyRXJhLnRvTnVtYmVyKCkpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMCk7XG4gICAgICBleHBlY3QoY3VycmVudFNlc3Npb24udmFsaWRhdG9yQ291bnQudG9OdW1iZXIoKSkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcbiAgICB9KTtcbiAgfSk7XG5cbn0pO1xuIl0sInZlcnNpb24iOjN9